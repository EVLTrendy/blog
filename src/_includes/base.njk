<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="fo-verify" content="80725f6c-bd05-4617-9441-22d8dec11e7f" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- WhatsApp Compliance: Critical meta tags must appear early in <head> -->
    <!-- Open Graph Tags - Universal fallback for all platforms -->
    {% set ogTitle = (title | truncate(95) if title else 'EvolvedLotus - Content Creation & Social Media Blog') %}
    {% set ogDescription = (description | truncate(75) if description else metadata.description | truncate(75) if metadata.description else 'Expert insights on content creation, social media marketing, and digital strategies for creators and businesses.') %}
    {% set canonicalUrl = (canonical if canonical else page.url | absoluteUrl) %}
    {% set ogImage = (image | absoluteUrl if image else metadata.image | absoluteUrl if metadata.image else 'https://blog.evolvedlotus.com/assets/images/default-og.png') %}
    {% set twitterImage = (twitter_image | absoluteUrl if twitter_image else metadata.twitter_image | absoluteUrl if metadata.twitter_image else ogImage) %}

    <meta property="og:title" content="{{ ogTitle }}">
    <meta property="og:type" content="{{ og_type if og_type else 'article' }}">
    <meta property="og:url" content="{{ canonicalUrl }}">
    <meta property="og:image" content="{{ ogImage }}">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:type" content="image/png">
    <meta property="og:description" content="{{ ogDescription }}">
    <meta property="og:locale" content="en_US">
    <meta property="og:site_name" content="EvolvedLotus Blog">

    <!-- Twitter Cards - Platform-specific overrides -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@evolvedlotus">
    <meta name="twitter:creator" content="@evolvedlotus">
    <meta name="twitter:title" content="{{ title | truncate(65) if title else ogTitle }}">
    <meta name="twitter:description" content="{{ ogDescription }}">
    <meta name="twitter:image" content="{{ twitterImage }}">
    <meta name="twitter:image:type" content="image/png">

    <!-- Enhanced Image Optimization for all platforms -->
    <meta property="og:image:alt" content="{{ imageAlt if imageAlt else title if title else 'EvolvedLotus Blog' }}">
    <meta name="twitter:image:alt" content="{{ imageAlt if imageAlt else title if title else 'EvolvedLotus Blog' }}">

    <!-- Additional meta tags for better SEO and social sharing -->
    <meta name="title" content="{{ title }}">
    <meta name="description" content="{{ description if description else metadata.description }}">
    <meta name="keywords" content="{{ keywords if keywords else 'content creation, social media, SEO, blogging, digital marketing' }}">
    <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
    <meta name="author" content="{{ author if author else 'EvolvedLotus' }}">
    <meta name="publisher" content="EvolvedLotus">
    <meta name="language" content="English">
    <meta name="geo.region" content="US">
    <meta name="geo.placename" content="United States">
    <meta name="distribution" content="global">
    <meta name="google-adsense-account" content="ca-pub-7311583434347173">

    <!-- Article-specific Open Graph enhancements -->
    {% if date %}
    <meta property="article:published_time" content="{{ date | isoDate }}">
    <meta property="article:modified_time" content="{{ date | isoDate }}">
    {% endif %}
    {% if author %}
    <meta property="article:author" content="{{ author }}">
    {% endif %}
    {% if tags %}
    {% for tag in tags %}
    <meta property="article:tag" content="{{ tag }}">
    {% endfor %}
    {% endif %}

    <!-- Platform-specific enhancements -->
    <!-- Discord Embed Tags -->
    <meta property="discord:embed" content="true">
    <meta property="discord:embed:title" content="{{ ogTitle }}">
    <meta property="discord:embed:description" content="{{ ogDescription }}">
    <meta property="discord:embed:image" content="{{ ogImage }}">
    <meta property="discord:embed:url" content="{{ canonicalUrl }}">
    <meta property="discord:embed:color" content="#007bff">

    <!-- LinkedIn Specific Tags -->
    <meta property="linkedin:owner" content="urn:li:organization:123456789">
    <meta property="linkedin:page" content="evolvedlotus">

    <!-- Pinterest Specific Tags -->
    <meta name="pinterest-rich-pin" content="true">

    <!-- WhatsApp Specific Tags (duplicates for priority) -->
    <meta property="whatsapp:image" content="{{ ogImage }}">
    <meta property="whatsapp:title" content="{{ ogTitle }}">
    <meta property="whatsapp:description" content="{{ ogDescription }}">

    <!-- Telegram Specific Tags -->
    <meta property="telegram:image" content="{{ ogImage }}">
    <meta property="telegram:title" content="{{ ogTitle }}">
    <meta property="telegram:description" content="{{ ogDescription }}">

    <!-- Reddit Specific Tags -->
    <meta property="reddit:card" content="summary_large_image">

    <!-- Theme and Appearance -->
    <meta property="theme-color" content="#007bff">
    <meta name="color-scheme" content="light">
    <meta name="msapplication-TileColor" content="#007bff">

    <!-- Structured Data for Rich Snippets -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "{{ schema_type if schema_type else 'Article' }}",
      "headline": "{{ title if title else ogTitle }}",
      "description": "{{ description if description else metadata.description if metadata.description else ogDescription }}",
      "image": "{{ ogImage }}",
      "datePublished": "{{ date | isoDate if date }}",
      "dateModified": "{{ date | isoDate if date }}",
      "author": {
        "@type": "Person",
        "name": "{{ author if author else 'EvolvedLotus' }}"
      },
      "publisher": {
        "@type": "Organization",
        "name": "EvolvedLotus",
        "logo": {
          "@type": "ImageObject",
          "url": "https://blog.evolvedlotus.com/assets/images/logo.png"
        }
      },
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "{{ canonicalUrl }}"
      },
      {% if tags %}
      "keywords": "{{ tags | join(', ') }}",
      {% endif %}
      "url": "{{ canonicalUrl }}"
    }
    </script>

    <title>{{ title }}</title>
    <link rel="canonical" href="{{ canonicalUrl }}" />
    <!-- SEO Enhancement: Add canonical tags to prevent duplicate content issues -->
    <link rel="stylesheet" href="/style.css">

    {# Added preconnect hints for critical third-party origins #}
    <link rel="preconnect" href="https://pagead2.googlesyndication.com">
    <link rel="preconnect" href="https://identity.netlify.com">
    <link rel="preconnect" href="https://ep2.adtrafficquality.google">
    <link rel="preconnect" href="https://www.googletagmanager.com">

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-S3F130EPMN"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-S3F130EPMN');
    </script>

</head>
<body>
    {% include 'header.njk' %}
    <div class="main-container">
        <main class="content-area">
            {{ content | safe }}
        </main>
        {% if ads is not defined or ads %}
        <aside class="sidebar-ad">
            <div class="ad-container sidebar-ad-container">
                <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7311583434347173"
                 crossorigin="anonymous"></script>
                <!-- displayad -->
                <ins class="adsbygoogle"
                     style="display:block"
                     data-ad-client="ca-pub-7311583434347173"
                     data-ad-slot="8054855733"
                     data-ad-format="auto"
                     data-full-width-responsive="true"></ins>
                <script>
                     (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
            </div>
        </aside>
        {% endif %}
    </div>
    {% include 'blogsign.njk' %}
    {% include 'footer.njk' %}

    {# 
      Moved all JavaScripts to just before the closing </body> tag for better performance.
      Added 'defer' to Netlify Identity, slideshow.js, and copy.js.
      Kept 'async' for Adsense script as it's already there and standard for ads.
    #}
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js" defer></script>
    <script>
        if (window.netlifyIdentity) {
            window.netlifyIdentity.on("init", user => {
                if (!user) {
                    window.netlifyIdentity.on("login", () => {
                        document.location.href = "/admin/";
                    });
                }
            });
        }
    </script>

    <script src="/assets/js/slideshow.js" defer></script>
    <script src="/assets/js/copy.js" defer></script>
</body>
</html>
